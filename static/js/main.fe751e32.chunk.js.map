{"version":3,"sources":["markerIcon.jpg","IconLocation.js","index.js"],"names":["L","icon","iconUrl","require","iconRetinaUrl","iconAnchor","shadowUrl","shadowSize","shadowAnchor","iconSize","className","user","prompt","Chat","props","handleSubmit","event","texto","target","value","keyCode","message","name","socket","emit","state","messages","this","io","path","transports","on","setState","map","index","moment","Date","parseInt","date","format","type","placeholder","onKeyUp","React","Component","MapRender","handleRequest","console","log","positions","flights","position","newJson","undefined","code","prevPos","flight","paths","Marker","Popup","Polyline","pathOptions","color","flightsInfo","passengers","flightsPaths","passenger","age","airline","origin","destination","plane","seats","onClick","MapContainer","center","lat","lng","zoom","TileLayer","attribution","url","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.fe751e32.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/markerIcon.f1573f89.jpg\";","import L from \"leaflet\";\r\n\r\nexport const IconLocation = L.icon({\r\n  iconUrl: require(\"./markerIcon.jpg\"),\r\n  iconRetinaUrl: require(\"./markerIcon.jpg\"),\r\n  iconAnchor: null,\r\n  shadowUrl: null,\r\n  shadowSize: null,\r\n  shadowAnchor: null,\r\n  iconSize: [35, 35],\r\n  className: \"leaflet-venue-icon\",\r\n});\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport io from \"socket.io-client\";\r\nimport moment from \"moment\";\r\nimport {\r\n  MapContainer,\r\n  Marker,\r\n  TileLayer,\r\n  Popup,\r\n  Polyline,\r\n} from \"react-leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"./map.css\";\r\nimport { IconLocation } from \"./IconLocation\";\r\nimport { Icon, map } from \"leaflet\";\r\n\r\nconst user = prompt(\"ingresar usuario\");\r\n\r\nclass Chat extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      messages: [],\r\n    };\r\n  }\r\n  componentDidMount() {\r\n    this.socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl/\", {\r\n      path: \"/flights\",\r\n      transports: [\"websocket\"],\r\n    });\r\n    this.socket.on(\"CHAT\", (message) => {\r\n      this.setState({ messages: [message, ...this.state.messages] });\r\n    });\r\n  }\r\n\r\n  handleSubmit = (event) => {\r\n    const texto = event.target.value;\r\n    if (event.keyCode === 13 && texto) {\r\n      const message = {\r\n        name: user,\r\n        message: texto,\r\n      };\r\n      //   ok this.setState({ messages: [message, ...this.state.messages] });\r\n      this.socket.emit(\"CHAT\", message);\r\n      event.target.value = \"\";\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const messages = this.state.messages.map((message, index) => {\r\n      return (\r\n        <li key={index}>\r\n          <b>\r\n            {moment(new Date(parseInt(message.date))).format(\r\n              \"DD MM YYYY hh:mm:ss\"\r\n            )}{\" \"}\r\n            - {message.name}: {message.message}\r\n          </b>\r\n        </li>\r\n      );\r\n    });\r\n    return (\r\n      <div>\r\n        <h1>Chat</h1>\r\n        <input type=\"text\" placeholder=\"\" onKeyUp={this.handleSubmit} />\r\n        {messages}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass MapRender extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      positions: {},\r\n      flights: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl/\", {\r\n      path: \"/flights\",\r\n      transports: [\"websocket\"],\r\n    });\r\n    this.socket.on(\"POSITION\", (position) => {\r\n      const newJson = this.state.positions;\r\n      if (newJson[position.code] == undefined) {\r\n        newJson[position.code] = {};\r\n        newJson[position.code].position = position.position;\r\n      } else {\r\n        if (newJson[position.code].prevPos == undefined) {\r\n          newJson[position.code].prevPos = [];\r\n        } else {\r\n          newJson[position.code].prevPos = [\r\n            ...newJson[position.code].prevPos,\r\n            newJson[position.code].position,\r\n          ];\r\n        }\r\n        newJson[position.code].position = position.position;\r\n      }\r\n      this.setState({ positions: newJson });\r\n    });\r\n\r\n    this.socket.on(\"FLIGHTS\", (flight) => {\r\n      this.setState({ flights: flight });\r\n    });\r\n  }\r\n\r\n  handleRequest = (event) => {\r\n    console.log(\"lo hicimos\");\r\n    this.socket.emit(\"FLIGHTS\");\r\n  };\r\n\r\n  render() {\r\n    let flights = [];\r\n    let paths = [];\r\n    for (const flight in this.state.positions) {\r\n      flights = [\r\n        <Marker position={this.state.positions[flight].position}>\r\n          <Popup>{flight}</Popup>\r\n        </Marker>,\r\n        ...flights,\r\n      ];\r\n      if (this.state.positions[flight].prevPos !== undefined) {\r\n        paths = [\r\n          <Polyline\r\n            pathOptions={{ color: \"red\" }}\r\n            positions={this.state.positions[flight].prevPos}\r\n          />,\r\n          ...paths,\r\n        ];\r\n      }\r\n    }\r\n    let flightsInfo = [];\r\n    let passengers = [];\r\n    let flightsPaths = [];\r\n    for (const flight in this.state.flights) {\r\n      for (const passenger in this.state.flights[flight].passengers)\r\n        passengers = [\r\n          <div>\r\n            <p>\r\n              {this.state.flights[flight].passengers[passenger].name},{\" \"}\r\n              {this.state.flights[flight].passengers[passenger].age} a√±os\r\n            </p>\r\n          </div>,\r\n          ...passengers,\r\n        ];\r\n      flightsInfo = [\r\n        <div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">Codigo: </p>\r\n            <p className=\"data\">{this.state.flights[flight].code}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">aerolinea: </p>\r\n            <p className=\"data\">{this.state.flights[flight].airline}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">origen: </p>\r\n            <p className=\"data\">{this.state.flights[flight].origin}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">destino: </p>\r\n            <p className=\"data\">{this.state.flights[flight].destination}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">avion: </p>\r\n            <p className=\"data\">{this.state.flights[flight].plane}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">Asientos: </p>\r\n            <p className=\"data\">{this.state.flights[flight].seats}</p>\r\n          </div>\r\n          <div className=\"data-container\">\r\n            <p className=\"label\">Pasajeros: </p>\r\n            {passengers}\r\n          </div>\r\n        </div>,\r\n        ...flightsInfo,\r\n      ];\r\n      flightsPaths = [\r\n        <Polyline\r\n          pathOptions={{ color: \"green\" }}\r\n          positions={[\r\n            this.state.flights[flight].origin,\r\n            this.state.flights[flight].destination,\r\n          ]}\r\n        />,\r\n        ...paths,\r\n      ];\r\n    }\r\n    return (\r\n      <div>\r\n        <button onClick={this.handleRequest}>Pedir informacion</button>\r\n        <div className=\"flights-info\">{flightsInfo}</div>\r\n        <MapContainer center={{ lat: \"4.6973985\", lng: \"13.41053\" }} zoom={2}>\r\n          <TileLayer\r\n            attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          />\r\n          {flights}\r\n          {paths}\r\n          {flightsPaths}\r\n        </MapContainer>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  render() {\r\n    return (\r\n      <div>\r\n        <MapRender />\r\n        <Chat />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}